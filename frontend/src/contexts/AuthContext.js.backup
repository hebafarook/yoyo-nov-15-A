import React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\n\nconst AuthContext = createContext();\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem('auth_token'));\n  const [loading, setLoading] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  // Set up axios interceptor for authentication\n  useEffect(() => {\n    const interceptor = axios.interceptors.request.use(\n      (config) => {\n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n      },\n      (error) => {\n        return Promise.reject(error);\n      }\n    );\n\n    return () => {\n      axios.interceptors.request.eject(interceptor);\n    };\n  }, [token]);\n\n  // Check if user is authenticated on mount\n  useEffect(() => {\n    const checkAuth = async () => {\n      if (token) {\n        try {\n          const response = await axios.get(`${API}/auth/profile`);\n          setUser(response.data.user);\n          setIsAuthenticated(true);\n        } catch (error) {\n          console.error('Token verification failed:', error);\n          logout();\n        }\n      }\n      setLoading(false);\n    };\n\n    checkAuth();\n  }, [token]);\n\n  const login = async (username, password) => {\n    try {\n      const response = await axios.post(`${API}/auth/login`, {\n        username,\n        password\n      });\n\n      const { access_token, user } = response.data;\n      \n      setToken(access_token);\n      setUser(user);\n      setIsAuthenticated(true);\n      localStorage.setItem('auth_token', access_token);\n      \n      return { success: true, user };\n    } catch (error) {\n      console.error('Login failed:', error);\n      return {\n        success: false,\n        error: error.response?.data?.detail || 'Login failed'\n      };\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      const response = await axios.post(`${API}/auth/register`, userData);\n      \n      const { access_token, user } = response.data;\n      \n      setToken(access_token);\n      setUser(user);\n      setIsAuthenticated(true);\n      localStorage.setItem('auth_token', access_token);\n      \n      return { success: true, user };\n    } catch (error) {\n      console.error('Registration failed:', error);\n      return {\n        success: false,\n        error: error.response?.data?.detail || 'Registration failed'\n      };\n    }\n  };\n\n  const logout = () => {\n    setToken(null);\n    setUser(null);\n    setIsAuthenticated(false);\n    localStorage.removeItem('auth_token');\n  };\n\n  const saveReport = async (reportData) => {\n    try {\n      const response = await axios.post(`${API}/auth/save-report`, reportData);\n      return { success: true, report: response.data };\n    } catch (error) {\n      console.error('Failed to save report:', error);\n      return {\n        success: false,\n        error: error.response?.data?.detail || 'Failed to save report'\n      };\n    }\n  };\n\n  const getSavedReports = async () => {\n    try {\n      const response = await axios.get(`${API}/auth/saved-reports`);\n      return { success: true, reports: response.data };\n    } catch (error) {\n      console.error('Failed to fetch saved reports:', error);\n      return {\n        success: false,\n        error: error.response?.data?.detail || 'Failed to fetch saved reports'\n      };\n    }\n  };\n\n  const deleteSavedReport = async (reportId) => {\n    try {\n      await axios.delete(`${API}/auth/saved-reports/${reportId}`);\n      return { success: true };\n    } catch (error) {\n      console.error('Failed to delete report:', error);\n      return {\n        success: false,\n        error: error.response?.data?.detail || 'Failed to delete report'\n      };\n    }\n  };\n\n  const value = {\n    user,\n    token,\n    isAuthenticated,\n    loading,\n    login,\n    register,\n    logout,\n    saveReport,\n    getSavedReports,\n    deleteSavedReport\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"